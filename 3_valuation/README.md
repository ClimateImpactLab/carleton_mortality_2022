## Run instructions

### 1. Set directory paths and Python environment.
Code in `3_valuation` operates using `cilpath` for Python.  The folders necessary for running the code are the following:

- Repository path (` REPO` ) - specifies the directory on the user's machine which contains this repository, e.g., `/User/MGreenstone/repositories`
- Data path ( `DB`) - specifies the location of the data folder downloaded from the online data repository. See "Downloading the data" in the master README for further instructions. 
- Output path (`OUTPUT`) - specifies the folder in which output from the analysis should be saved. This includes all tables and figures in the main text and appendix of Carleton et al. (2019). 

If `cilpath` is not installed, users can manually specify these base directories within the master scripts discussed below. 

A number of external packages are required to run the code. We provide a `mortalityverse.yml` file that will allow users to create a `conda` environment with the requisite packages. To do so, install the [latest version](https://docs.conda.io/en/latest/miniconda.html) of `conda` and run the following:

```bash
cd /path/to/mortality/3_valuation
conda env create -f mortalityverse.yml
conda activate mortalityverse
```

### 2. Run projections or download Monte Carlo simulation output.
The valuation code in this repository relies upon raw netCDF4 output from the projection system. For those attempting to fully replicate this step of the analysis, the raw Monte Carlo simulations must exist in `data`. However, since generating the full set of simulations is far too computationally intensive for the average user, we provide functionality for valuing a single climate model (see below). 

Whether valuing impacts from a single climate model or the full set of Monte Carlo simulations, projection output must be generated by the Climate Impact Lab projection system (see the `impact_calculations` repository) or downloaded from the [online data repository](https://gitlab.com/ClimateImpactLab/Impacts/mortality/-/tree/dylan#downloading-the-data).


### 3. Calculate Value of Statistical Life (VSL) and related values.
`generate_vsl_data.py` is a "master" script that generates inputs to the valuation of impacts. In particular, it generates (1) the monetary VSLs that are multiplied by the impacts to achieve monetized damages and, (2) the age-adjustment factors that are required for valuation assumptions which heterogeneously value the three age-groups.

### 4. Generate monetized damages by applying the VSL assumptions to projected impacts.

`run_damages.py` is the "master" script which uses the inputs from Step 3 to value projected mortality impacts. This script outputs data at two geographic resolutions:

1. Global damages, which are used to estimate damage functions in `4_damage_functions`';
2. Impact region level damages, which do not appear directly in the paper, but are used for diagnostic and communication purposes.


## Folder Structure

`1_utils`- Contains functions for initializing the R environment and generating the figures and in-text summary stats in Carleton et al. (2019). See the `README` in this folder for details on the functions written for this stage of the analysis.

`2_run_projections` - Configuration files and helpful bash scripts for generating, aggregating, and extracting projected mortality impacts based upon the model inputs generated in `1_estimation`. See the `impact-calculations` repository for detailed documentation and run instructions for the Climate Impact Lab projection system.

`3_generate_figures` - Contains documented master script for generating post-projection figures in Carleton et al. (2019).

`4_in-text_stats` - Contains master script for generating in-text statistics based upon projection and valuation results.